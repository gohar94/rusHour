<!DOCTYPE html>
<html lang="en">
<html>
  <head>
  	<meta charset="utf-8">
    <title>RusHour</title>
  </head>
  <body>
    <h1>Update Service Count</h1>
    <ul id="messages"></ul>
    <div>
    	<form accept-charset="UTF-8" action="http://localhost:3000/services/update_count" method="post" id="update_count">
	    	<table>
          <tr>
            <td><label for="operator">Operator</label></td>
            <td><input id="operator" name="operator" type="text" /></td>
          </tr>
		    	<tr>
			    	<td><label for="count">Count</label></td>
			    	<td><input id="count" name="count" type="text" /></td>
		    	</tr>
		    	<tr>
		    		<!-- 551308f413c2be4d33b8bedd -->
			    	<td><label for="id">id</label></td>
			    	<td><input id="id" name="id" type="text" /></td>
		    	</tr>
		    	<tr>
			    	<td><input name="submit" type="submit" value="Update" /></td>
		    	</tr>
	    	</table>
    	</form>
    </div>
  
  </body>
</html>
<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
<script src="http://code.jquery.com/jquery-1.11.1.js"></script>
<script>
  var socket = io("http://localhost:3000");
  $('form#update_count').submit(function(){
    
    var id = $("#id").val();
    var count = $("#count").val();
    var operator = $("#operator").val();
    console.log(id);
    console.log(count);

    jQuery.support.cors = true;
    $.ajax({
        url: 'http://localhost:3000/services/update_count',
        type: 'post',
        dataType: 'json',
        data: {id: id, count: count, operator: operator},
        success: function(data) {
          console.log(data);
          $('#messages').append($('<li>').text(data.name + " " + data.count));
        }
    });

    var stringToEmit = id + "/" + count + "/" + operator;
    socket.emit('update_count', stringToEmit);
    $('#count').val('');
    
    return false;
  });
  socket.on('update_count', function(msg){
    $('#messages').append($('<li>').text(msg));
  });
</script>